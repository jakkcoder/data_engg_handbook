# Data Modeling for Analytics â€“ OLTP, OLAP, Star & SCD (Chapter 27)

---

## ğŸ¯ Why Data Modeling Matters in Data Engineering

â†’ Data modeling decides:
- Query performance
- Data correctness
- Scalability
- Cost

âš ï¸ Bad data models = slow queries + expensive pipelines

---

## ğŸ” OLTP vs OLAP (VERY IMPORTANT)

```

OLTP  â†’  Operational Systems
OLAP  â†’  Analytical Systems

```

---

### ğŸ§¾ OLTP (Online Transaction Processing)

â†’ Used for **day-to-day operations**

Examples:
- Orders
- Payments
- User profiles

Characteristics:
- High number of **small transactions**
- Frequent INSERT / UPDATE / DELETE
- Highly normalized
- Strict ACID guarantees

Examples:
- MySQL
- PostgreSQL
- Oracle

---

### ğŸ“Š OLAP (Online Analytical Processing)

â†’ Used for **analytics & reporting**

Examples:
- Business reports
- Dashboards
- Aggregations

Characteristics:
- Read-heavy
- Large scans
- Complex queries
- Mostly INSERT-only
- Optimized for SELECT

Examples:
- Redshift
- BigQuery
- Snowflake

---

## ğŸ§  Key Difference

| OLTP | OLAP |
|----|----|
Normalized | Denormalized |
Write-heavy | Read-heavy |
Row-oriented | Column-oriented |
Many small queries | Few large queries |

---

## ğŸ—ï¸ Fact & Dimension Tables

```

FACT TABLE
|
|--- Dimension Tables

````

---

### ğŸ“¦ Fact Table

â†’ Stores **measurable business metrics**

Examples:
- sales_amount
- quantity
- revenue

Characteristics:
- Very large
- Mostly numeric
- Foreign keys to dimensions
- Append-only

Example:
```text
fact_orders
(order_id, customer_id, product_id, date_id, amount)
````

---

### ğŸ§© Dimension Table

â†’ Stores **descriptive attributes**

Examples:

* customer name
* product category
* location

Characteristics:

* Smaller than fact tables
* Text-heavy
* Slowly changing

Example:

```text
dim_customer
(customer_id, name, city, country)
```

---

## â­ Star Schema (MOST COMMON)

```
           dim_customer
                 |
dim_product -- fact_sales -- dim_date
                 |
           dim_store
```

---

### Why Star Schema?

â†’ Simple
â†’ Fewer joins
â†’ Fast queries
â†’ Easy to understand

---

### Characteristics

* One fact table
* Multiple denormalized dimensions
* Optimized for BI tools

---

## â„ï¸ Snowflake Schema

â†’ Extension of Star Schema
â†’ Dimensions are **normalized**

```
fact_sales
   |
dim_product â†’ dim_category â†’ dim_department
```

---

### Star vs Snowflake

| Star           | Snowflake    |
| -------------- | ------------ |
| Simple         | Complex      |
| Faster queries | More joins   |
| More storage   | Less storage |

ğŸ‘‰ **Star schema preferred in interviews**

---

## ğŸ”„ Slowly Changing Dimensions (SCD)

â†’ Used when **dimension data changes over time**

Example:

* Customer address changes
* Product price category changes

---

### SCD Type 0 â€“ Ignore Changes

â†’ No updates allowed
â†’ Data remains unchanged

Use case:

* Date of birth

---

### SCD Type 1 â€“ Overwrite

â†’ Old value is replaced
â†’ No history preserved

```text
Old city â†’ New city (overwrite)
```

Use case:

* Correcting wrong data

---

### SCD Type 2 â€“ Maintain History (VERY IMPORTANT)

â†’ Each change creates a **new row**

Additional columns:

* start_date
* end_date
* is_current

Example:

```text
customer_id | city | start_date | end_date | is_current
```

Use case:

* Regulatory reporting
* Historical analytics

---

### SCD Type 3 â€“ Limited History

â†’ Store **previous value** in same row

Example:

```text
current_city | previous_city
```

Use case:

* Limited comparison

---

## ğŸ§  Choosing the Right SCD Type

| Scenario              | SCD Type |
| --------------------- | -------- |
| Fix data error        | Type 1   |
| Need full history     | Type 2   |
| Need last change only | Type 3   |

---

## ğŸ“ Grain (INTERVIEW MUST)

â†’ Grain defines **what one row represents**

Examples:

* One row per order
* One row per customer per day

âš ï¸ Grain must be defined **before designing fact table**

---

## ğŸ§ª Surrogate Key vs Natural Key

### Natural Key

â†’ Comes from source system
â†’ Can change

Example:

* email
* SSN

---

### Surrogate Key

â†’ Artificial key
â†’ Generated by system
â†’ Stable

Example:

* customer_sk

ğŸ‘‰ **Always use surrogate keys in dimensions**

---

## ğŸ§± Degenerate Dimensions

â†’ Dimension attributes stored **inside fact table**

Example:

* order_id
* invoice_number

Reason:

* No additional attributes needed

---

## ğŸ§  Conformed Dimensions

â†’ Same dimension shared across multiple fact tables

Example:

* dim_date
* dim_customer

Benefits:

* Consistent reporting
* Reusable analytics

---

## âš¡ Common Interview Modeling Questions

* What is the grain of your fact table?
* Why choose Star over Snowflake?
* How do you handle dimension changes?
* How do you design for late-arriving data?
* Why surrogate keys are needed?

---

## âœ… Chapter 27 Summary

* OLTP â‰  OLAP
* Fact tables store metrics
* Dimension tables store context
* Star schema is interview favorite
* SCD Type 2 is most important
* Grain definition is critical
* Surrogate keys ensure stability
